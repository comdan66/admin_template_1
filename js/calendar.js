$(function(){function a(a){return a-1911}function t(a){return m[(a-4)%12]}function n(a){return a=a-1900+36,p[a%10]+o[a%12]}function r(a,t){return t=parseInt(t,10),a=parseInt(a,10),1==--t?a%4===0&&a%100!==0||a%400===0?29:28:[31,28,31,30,31,30,31,31,30,31,30,31][t]}function e(a,t){return t=isNaN(a)?a.m:parseInt(t,10),a=isNaN(a)?a.y:parseInt(a,10),{y:1==t?a-1:a,m:1==t?12:t-1,c:r(a,1==t?12:t-1)}}function d(a,t){return t=isNaN(a)?a.m:parseInt(t,10),a=isNaN(a)?a.y:parseInt(a,10),{y:12==t?a+1:a,m:12==t?1:t+1}}function l(a,t){t=isNaN(a)?a.m:parseInt(t,10),a=isNaN(a)?a.y:parseInt(a,10);var n=new Date(a,t-1,1).getDay(),l=r(a,t),i=parseInt((n+l)/7,10)+((n+l)%7?1:0),s=e(a,t),u=d(a,t),p=new Date;return Array.apply(null,Array(i)).map(function(r,e){return Array.apply(null,Array(7)).map(function(r,d){var i=7*e+d-n+1,o={y:i>0?i>l?u.y:a:s.y,m:i>0?i>l?u.m:t:s.m,d:(i>0?i>l?-l:0:s.c)+i},m=window.LunarCalendar.solarToLunar(o.y,o.m,o.d);return{y:o.y,m:o.m,d:o.d,t:o.y==p.getFullYear()&&o.m==p.getMonth()+1&&o.d==p.getDate(),l:1==m.lunarDay?m.lunarMonthName:m.lunarDayName,nl:1==m.lunarDay,h:m.worktime,f:(m.term?[m.term]:[]).concat(m.solarFestival.concat(m.lunarFestival))}})})}function i(a,t){return t=isNaN(a)?a.m:parseInt(t,10),a=isNaN(a)?a.y:parseInt(a,10),$("<div />").addClass("month").append($("<div />").addClass("weeks").append(u.map(function(a){return $("<div />").text(a)}))).append(l(a,t).map(function(n){return $("<div />").addClass("days").append(n.map(function(n){return $("<div />").addClass(n.y!=a||n.m!=t?"not-this-month":null).addClass(n.t?"today":null).addClass(n.nl?"new-lunar":null).addClass(n.h?"holiday":null).attr("data-y",n.y).attr("data-m",n.m).attr("data-d",n.d).attr("data-l",n.l).append(n.f.length?$("<span />").text(n.f.join(", ")):null)}))}))}function s(a,t,n){n=isNaN(t)?t.m:parseInt(n,10),t=isNaN(t)?t.y:parseInt(t,10);var r=e(t,n),l=d(t,n);return a.empty().append(i(r)).append(i(t,n)).append(i(l))}var u=["日","一","二","三","四","五","六"],p=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],o=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],m=["鼠","牛","虎","兔","龍","蛇","馬","羊","猴","雞","狗","豬"];window.LunarCalendar.setSolarFestival({d0907:[["泰瑞生日"],!1]}),window.LunarCalendar.setLunarFestival({d0812:[["泰瑞生日"],!1]}),$(".calendar").each(function(){var r=$(this),l=new Date,u=r.find(".now").attr("data-y",l.getFullYear()).attr("data-m",l.getMonth()+1).attr("data-l",a(l.getFullYear())).attr("data-gz",n(l.getFullYear())).attr("data-a",t(l.getFullYear())),p=s(r.find(".months"),u.data("y"),u.data("m"));r.find(".arr a").click(function(){var r={};if(0===$(this).index()){var l=new Date;r={y:l.getFullYear(),m:l.getMonth()+1},s(p,r)}else 1==$(this).index()?(r=e(u.attr("data-y"),u.attr("data-m")),p.prepend(i(e(r))),p.find(".month").last().remove()):2==$(this).index()&&(r=d(u.attr("data-y"),u.attr("data-m")),p.append(i(d(r))),p.find(".month").first().remove());u.attr("data-y",r.y).attr("data-m",r.m).attr("data-l",a(r.y)).attr("data-gz",n(r.y)).attr("data-a",t(r.y))})})});